resources:
  - name: concourse-pytest
    type: git
    source:
      uri: https://github.com/95rade/pytest-tutorial
      branch: main

jobs:
  - name: install-dependancies
    plan:
      - get: concourse-pytest
        trigger: true
      - task: install-dependancies
        config:
          platform: linux
          image_resource:
            type: docker-image
            source: {repository: python}
          inputs:
            - name: concourse-pytest
          outputs: 
            - name: pytest-installed
          run:
            path: /bin/sh
            args:
            - -c
            - |
              pip3 install pytest pytest-xdist

  - name: execute-pytest
    serial: true
    plan:
      - get: concourse-pytest
        trigger: true
        passed: [install-dependancies]
      - task: run-pytest
        config:
          platform: linux
          image_resource:
            type: docker-image
            source: {repository: python}
          inputs:
            - name: concourse-pytest
            - name: pytest-installed
          run:
            dir: concourse-pytest
            #path: python
            #args:
            #  - -m pytest
            path: /bin/sh
            args:
            - -c
            - |
              #pip3 install pytest pytest-xdist
              pwd
              ls -al
              python -m pytest -v test_compare.py